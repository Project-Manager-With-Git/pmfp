import unittest
from test.get_app import app

socketio = app.extensions['socketio']


def setUpModule():
    print("setUpModule")


def tearDownModule():
    print("tearUpModule")


class TestSocketIO(unittest.TestCase):
    @classmethod
    def setUpClass(cls):
        pass

    @classmethod
    def tearDownClass(cls):
        pass

    def setUp(self):
        pass

    def tearDown(self):
        pass

    def test_emit_event(self):
        client = socketio.test_client(app, namespace='/test')
        client.get_received("/ns")
        client.emit('ping', {'a': 'b'}, namespace='/test')
        received = client.get_received('/test')
        self.assertEqual(len(received), 1)
        self.assertEqual(len(received[0]['args']), 1)
        self.assertEqual(received[0]['name'], 'my custom response')
        self.assertEqual(received[0]['args'][0]['a'], 'b')


if __name__ == '__main__':
    unittest.main()